@startuml start_worker_thread
skinparam sequenceMessageAlign center
[-> Library: Create Generic Trace Library

Library -> ObjectFactory: CreateTraceJobProcessor()
ObjectFactory --> Library: return TraceJobProcessor
|||
Library -> ObjectFactory: CreateDaemonCommunicator()
ObjectFactory --> Library: return DaemonCommunicator
Library -> DaemonCommunicator: SubscribeToDaemonTerminationNotification(termination_cb)
|||
group CreateTraceMetaDataSharedMemory()
    Library -> SharedMemoryFactory: SetTypedMemoryProvider(TypedMemory::Default())
    Library -> SharedMemoryFactory: trace_metadata_memory_resource_ = Create()
    SharedMemoryFactory --> Library: return memory area
    alt trace_metadata_memory_resource_ == nullptr || trace_metadata_memory_resource_->getBaseAddress() == nullptr
        Library -> Library: state_ = LibraryState::kGenericError
        Library -> SharedMemoryFactory: trace_metadata_memory_resource_ = Remove()
    end
    Library -> Library: create_tmd_result_ = kSharedMemoryObjectRegistrationFailedFatal
    alt trace_metadata_memory_resource_ is not in typed memory
        Library -> SharedMemoryFactory: trace_metadata_memory_resource_ = Remove()
        Library -> Library: create_tmd_result_ = kSharedMemoryObjectRegistrationFailedFatal
    end
end
|||
Library -> ObjectFactory: CreateTraceJobAllocator()
ObjectFactory --> Library: return trace_job_allocator_result_

[<- Library: spawn WorkerThread(stop_token)
@enduml
